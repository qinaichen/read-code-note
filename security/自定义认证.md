# 自定义认证

`spring security`默认提供了`user`用户，我们也可以在配置文件中自定义一个用户，但是这远远不能满足我们的需求，我们还需要更多的可能，所以我们要对`spring security`做一些配置

## 创建配置类


创建一个`WebSecurityConfigurerAdapter`的子类作为`spring security`的配置类

```java
package org.security.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;

@Configuration
public class SecurityConfig extends WebSecurityConfigurerAdapter {



}

```

## 密码加密

在新版本的`spring security`中，不再支持明文密码，所以首先要指定密码加密规则，我们这里采用框架中推荐的加密规则,在`SecurityConfig`中增加方法，创建密码加密对象

```java
@Bean
public PasswordEncoder passwordEncoder(){
    return PasswordEncoderFactories.createDelegatingPasswordEncoder();
}

```


## 内存数据登录

在`SecurityConfig` 重写父类的方法，将用户添加到内存中,并且要将配置文件中配置的用户信息删除

```java
@Override
protected void configure(AuthenticationManagerBuilder auth) throws Exception {
    auth.inMemoryAuthentication()
            .withUser("admin")
            .password(passwordEncoder().encode("1234"))
            .authorities("ROLE_ADMIN");
}
```

此时我们启动应用，从浏览器中访问`http://localhost:8080`,然后从框架提供的默认登录页面中，进行登录



## 数据库数据登录

- 添加jpa依赖

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
</dependency>
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid</artifactId>
    <version>1.1.20</version>
</dependency>

```

- 增加配置

```yml

spring:
  thymeleaf:
    mode: HTML
    cache: false
    encoding: UTF-8
    prefix: file:src/main/resources/templates/
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/security?serverTimezone=Asia/Shanghai
    username: root
    password: 123456
    type: com.alibaba.druid.pool.DruidDataSource
  jpa:
    database-platform: org.hibernate.dialect.MySQL8Dialect
    show-sql: true
    hibernate:
      ddl-auto: update
```

> `spring security`中对基于数据库的认证的方式规定，要实现`org.springframework.security.core.userdetails.UserDetailsService` 接口，并且要实现 `UserDetails loadUserByUsername(String username) throws UsernameNotFoundException`方法，`loadUserByUsername`方法中的参数`username`就是用户从页面中输入的用户名




